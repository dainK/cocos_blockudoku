System.register("chunks:///_virtual/Block.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Shapes.ts"],(function(t){var o,e,n,s,i,r,h,a,c,l,d;return{setters:[function(t){o=t.inheritsLoose},function(t){e=t.cclegacy,n=t._decorator,s=t.Node,i=t.Color,r=t.instantiate,h=t.Sprite,a=t.UITransform,c=t.Vec3,l=t.Component},function(t){d=t.SHAPES}],execute:function(){var p;e._RF.push({},"28b44c6V5xKdp6XNZYgOjGF","Block",void 0);var u=n.ccclass;n.property,t("Block",u("Block")(p=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(o=t.call.apply(t,[this].concat(n))||this).tray=void 0,o.board=void 0,o.cellPrefab=void 0,o.shape=[],o.cells=[],o.color=i.WHITE,o.startPos=new c,o}o(e,t);var n=e.prototype;return n.start=function(){this.node.on(s.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(s.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(s.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(s.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},n.initRandom=function(){this.shape=d[Math.floor(Math.random()*d.length)];var t=[new i(255,99,71),new i(100,149,237),new i(60,179,113),new i(238,130,238),new i(255,215,0)];this.color=t[Math.floor(Math.random()*t.length)],this.build(),this.node.setScale(.6,.6,1)},n.build=function(){this.node.removeAllChildren(),this.cells.length=0;for(var t=0;t<5;t++)for(var o=0;o<5;o++)if(this.shape[t][o]){var e=r(this.cellPrefab);e.setParent(this.node),e.setPosition(80*o,80*-t),e.getComponent(h).color=this.color,this.cells.push(e)}var n=this.node.getComponent(a);n.setAnchorPoint(0,1),n.setContentSize(400,400)},n.getShapeOffset=function(){for(var t=5,o=5,e=0;e<5;e++)for(var n=0;n<5;n++)this.shape[e][n]&&(t=Math.min(t,n),o=Math.min(o,e));return{minX:t,minY:o}},n.onTouchStart=function(){this.startPos.set(this.node.position),this.node.setScale(1,1,1)},n.onTouchMove=function(t){var o=t.getUIDelta();this.node.setPosition(this.node.position.x+o.x,this.node.position.y+o.y);var e=this.node.worldPosition.clone(),n=this.board.worldToGridTopLeft(e),s=n.x,i=n.y;this.board.preview(this.shape,s,i)},n.onTouchEnd=function(){this.node.setScale(.6,.6,1);var t=this.node.worldPosition.clone(),o=this.board.worldToGridTopLeft(t),e=o.x,n=o.y;this.board.clearPreview(),this.board.canPlace(this.shape,e,n)?(this.board.place(this.shape,e,n,this.color),this.onDropSuccess()):this.node.setPosition(this.startPos)},n.onDropSuccess=function(){this.node.destroy(),this.tray.node.children.length-1==0&&this.tray.spawn(),this.board.canPlaceAny(this.tray.blocks)||this.board.gameOver()},e}(l))||p);e._RF.pop()}}}));

System.register("chunks:///_virtual/Board.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UI.ts"],(function(e){var i,t,r,o,l,s,n,a,h,c,f,u,v,d;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,o=e.assertThisInitialized,l=e.createForOfIteratorHelperLoose},function(e){s=e.cclegacy,n=e._decorator,a=e.Prefab,h=e.instantiate,c=e.Sprite,f=e.Color,u=e.UITransform,v=e.Component},function(e){d=e.UI}],execute:function(){var g,p,z,b,m,C,y;s._RF.push({},"95d17EgWwdBvJlDTLgn8k2w","Board",void 0);var S=n.ccclass,w=n.property;e("Board",(g=S("Board"),p=w(d),z=w(a),g((C=i((m=function(e){function i(){for(var i,t=arguments.length,l=new Array(t),s=0;s<t;s++)l[s]=arguments[s];return i=e.call.apply(e,[this].concat(l))||this,r(i,"ui",C,o(i)),r(i,"cellPrefab",y,o(i)),i.size=8,i.cellSize=80,i.grid=[],i.cellNodes=[],i.previewCells=[],i.combo=0,i}t(i,e);var s=i.prototype;return s.start=function(){this.initGrid(),this.createBoardVisual(),this.ui.board=this},s.initGrid=function(){var e=this;this.grid=Array.from({length:this.size},(function(){return Array(e.size).fill(!1)})),this.cellNodes=Array.from({length:this.size},(function(){return Array(e.size).fill(null)}))},s.createBoardVisual=function(){for(var e=this.size*this.cellSize/2,i=0;i<this.size;i++)for(var t=0;t<this.size;t++){var r=h(this.cellPrefab);r.setParent(this.node),r.setPosition(-e+t*this.cellSize+this.cellSize/2,e-i*this.cellSize-this.cellSize/2),r.getComponent(c).color=f.WHITE,this.cellNodes[i][t]=r}this.node.getComponent(u).setContentSize(this.size*this.cellSize,this.size*this.cellSize)},s.worldToGridTopLeft=function(e){var i=this.node.getComponent(u).convertToNodeSpaceAR(e),t=-this.size*this.cellSize/2,r=this.size*this.cellSize/2;return{x:Math.floor((i.x-t)/this.cellSize),y:Math.floor((r-i.y)/this.cellSize)}},s.canPlace=function(e,i,t){for(var r=e.length,o=e[0].length,l=0;l<r;l++)for(var s=0;s<o;s++)if(0!=e[l][s]){var n=i+s,a=t+l;if(n<0||n>=this.size||a<0||a>=this.size)return!1;if(this.grid[a][n])return!1}return!0},s.place=function(e,i,t,r){for(var o=e.length,l=e[0].length,s=0;s<o;s++)for(var n=0;n<l;n++)if(e[s][n]){var a=i+n,h=t+s;this.grid[h][a]=!0,this.cellNodes[h][a].getComponent(c).color=r}this.checkAndClearLines()},s.checkAndClearLines=function(){for(var e=[],i=[],t=0;t<this.size;t++){for(var r=!0,o=0;o<this.size;o++)if(!this.grid[t][o]){r=!1;break}r&&e.push(t)}for(var l=0;l<this.size;l++){for(var s=!0,n=0;n<this.size;n++)if(!this.grid[n][l]){s=!1;break}s&&i.push(l)}if(e.length||i.length){this.clearLines(e,i);var a=Math.min(e.length,i.length),h=Math.max(e.length,i.length),c=100*e.length+100*i.length+50*a;this.ui.addScore(c+c*this.combo*.5,this.combo,a,h),this.combo++}else this.combo=0},s.clearLines=function(e,i){for(var t,r=l(e);!(t=r()).done;)for(var o=t.value,s=0;s<this.size;s++)this.grid[o][s]=!1,this.clearCell(o,s);for(var n,a=l(i);!(n=a()).done;)for(var h=n.value,c=0;c<this.size;c++)this.grid[c][h]=!1,this.clearCell(c,h)},s.clearCell=function(e,i){this.cellNodes[e][i].getComponent(c).color=f.WHITE},s.clearPreview=function(){for(var e,i=l(this.previewCells);!(e=i()).done;){var t=e.value,r=this.cellNodes[t.by][t.bx];r&&(r.getComponent(c).color=f.WHITE)}this.previewCells.length=0},s.preview=function(e,i,t){if(this.clearPreview(),this.canPlace(e,i,t)){for(var r=e.length,o=e[0].length,s=0;s<r;s++)for(var n=0;n<o;n++)if(e[s][n]){var a=i+n,h=t+s;this.previewCells.push({bx:a,by:h})}for(var u,v=l(this.previewCells);!(u=v()).done;){var d=u.value,g=this.cellNodes[d.by][d.bx];g&&(g.getComponent(c).color=new f(100,255,100,180))}}},s.getShapeCells=function(e){for(var i=[],t=0;t<5;t++)for(var r=0;r<5;r++)1===e[t][r]&&i.push({x:r,y:t});return i},s.canPlaceAny=function(e){for(var i,t=l(e);!(i=t()).done;)for(var r=i.value.shape,o=r.length,s=r[0].length,n=1-o;n<this.size;n++)for(var a=1-s;a<this.size;a++)if(this.canPlace(r,a,n))return console.log("can"),!0;return console.log("nocan"),!1},s.gameOver=function(){this.ui.onGameOver()},s.reset=function(){for(var e=0;e<this.size;e++)for(var i=0;i<this.size;i++)this.grid[e][i]=!1,this.clearCell(e,i);this.combo=0},i}(v)).prototype,"ui",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=i(m.prototype,"cellPrefab",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=m))||b));s._RF.pop()}}}));

System.register("chunks:///_virtual/Cell.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,t,c,r;return{setters:[function(e){n=e.inheritsLoose},function(e){t=e.cclegacy,c=e._decorator,r=e.Component}],execute:function(){var l;t._RF.push({},"3f3181IgxZMpJqpvI2U2aJX","Cell",void 0);var o=c.ccclass;e("Cell",o("Cell")(l=function(e){function t(){for(var n,t=arguments.length,c=new Array(t),r=0;r<t;r++)c[r]=arguments[r];return(n=e.call.apply(e,[this].concat(c))||this).occupied=!1,n}return n(t,e),t}(r))||l);t._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./Block.ts","./Board.ts","./Cell.ts","./Shapes.ts","./Tray.ts","./UI.ts"],(function(){return{setters:[null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/Shapes.ts",["cc"],(function(e){var c;return{setters:[function(e){c=e.cclegacy}],execute:function(){c._RF.push({},"265fcv6FehGNKTClzJOgUZI","Shapes",void 0);e("SHAPES",[[[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[0,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],[[0,0,0,0,0],[0,1,1,0,0],[0,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,1,0,0],[0,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,0],[0,0,1,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,1,1,0,0],[0,0,1,1,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,1,1,0],[0,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,1,0,0,0],[0,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,1,0],[0,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,1,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,1,0],[0,0,0,1,0],[0,0,1,1,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,0],[0,0,0,1,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,0],[0,1,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,1,1,1,0],[0,1,1,1,0],[0,1,1,1,0],[0,0,0,0,0]]]);c._RF.pop()}}}));

System.register("chunks:///_virtual/Tray.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Block.ts","./Board.ts"],(function(e){var r,t,n,i,o,a,l,c,s,u,f,p;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized,o=e.createClass},function(e){a=e.cclegacy,l=e._decorator,c=e.Prefab,s=e.instantiate,u=e.Component},function(e){f=e.Block},function(e){p=e.Board}],execute:function(){var b,h,d,y,P,m,v,g,k;a._RF.push({},"43d255fi/FFuofxezqrQm88","Tray",void 0);var w=l.ccclass,z=l.property;e("Tray",(b=w("Tray"),h=z(c),d=z(p),y=z(c),b((v=r((m=function(e){function r(){for(var r,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return r=e.call.apply(e,[this].concat(o))||this,n(r,"blockPrefab",v,i(r)),n(r,"board",g,i(r)),n(r,"cellPrefab",k,i(r)),r}t(r,e);var a=r.prototype;return a.start=function(){this.spawn(),this.board.ui.tray=this},a.spawn=function(){this.node.removeAllChildren();for(var e=2;e>-1;e--){var r=s(this.blockPrefab);r.setParent(this.node),r.setPosition(250*(e-1),0);var t=r.getComponent(f);t.tray=this,t.board=this.board,t.cellPrefab=this.cellPrefab,t.initRandom()}},a.reset=function(){this.spawn()},o(r,[{key:"blocks",get:function(){return this.node.children.map((function(e){return e.getComponent(f)})).filter((function(e){return null!=e}))}}]),r}(u)).prototype,"blockPrefab",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=r(m.prototype,"board",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=r(m.prototype,"cellPrefab",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=m))||P));a._RF.pop()}}}));

System.register("chunks:///_virtual/UI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,o,i,n,a,s,l,c,u,b,p,h,g,v,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){n=e.cclegacy,a=e._decorator,s=e.Label,l=e.Node,c=e.Button,u=e.Prefab,b=e.Tween,p=e.instantiate,h=e.Sprite,g=e.Color,v=e.Vec3,m=e.Component}],execute:function(){var d,f,y,w,S,L,I,C,T,z,N,U,M;n._RF.push({},"77ea5LY9blMUJTDLgn/WcJr","UI",void 0);var O=a.ccclass,D=a.property;e("UI",(d=O("UI"),f=D(s),y=D(s),w=D(l),S=D(c),L=D(u),d((T=t((C=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(t=e.call.apply(e,[this].concat(n))||this).tray=void 0,t.board=void 0,o(t,"scoreLabel",T,i(t)),o(t,"bestScoreLabel",z,i(t)),o(t,"gameOver",N,i(t)),o(t,"replay",U,i(t)),o(t,"combo",M,i(t)),t.score=0,t.scoreTween=void 0,t}r(t,e);var n=t.prototype;return n.start=function(){this.replay.node.on(c.EventType.CLICK,this.onReplay.bind(this)),this.reset()},n.addScore=function(e,t,r,o){var i,n=this;this.score+=e;var a=.01*Math.abs(Number(this.scoreLabel.string)-this.score),l={value:Number(this.scoreLabel.string)};if(null==(i=this.scoreTween)||i.stop(),this.scoreTween=new b(l).to(a,{value:this.score},{onUpdate:function(){n.scoreLabel.string=Math.floor(l.value).toString()}}).start(),t>0){var c=p(this.combo);this.node.addChild(c);var u=e*t*.5;c.getChildByName("Win").getComponent(s).string=u.toString();var m=c.addComponent(h);new b(m).to(.5,{color:new g(255,255,255,0)}).start(),new b(c).to(.6,{position:new v(0,50),scale:new v(1,1)}).call((function(){c.destroy()})).start()}},n.onGameOver=function(){var e;null==(e=this.scoreTween)||e.stop(),this.scoreLabel.string=this.score.toString();var t=Number(localStorage.getItem("bestScore"))||0;localStorage.setItem("bestScore",Math.max(this.score,t).toString()),this.gameOver.active=!0,console.log("over")},n.reset=function(){this.scoreLabel.string="0";var e=Number(localStorage.getItem("bestScore"))||0;this.bestScoreLabel.string=e.toString(),this.gameOver.active=!1},n.onReplay=function(){this.reset(),this.board.reset(),this.tray.reset()},t}(m)).prototype,"scoreLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=t(C.prototype,"bestScoreLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=t(C.prototype,"gameOver",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U=t(C.prototype,"replay",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=t(C.prototype,"combo",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=C))||I));n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});